<% include head %>
<% include headContent %>

<form id="editGroupForm" action="<%= instance.uri %>/add" method="POST">
    <div class="layout">
        <h2><%= __("Group settings") %></h2>

        <div class="admin-panel__widget">
            <label class="admin-panel__title" for="name"><%= __("Group name") %></label>
            <div class="widget_narrow" >
                <input class="clr-input" type="text" id="name" name="name" value="<%= group.name %>">
            </div>
        </div>

        <div class="admin-panel__widget">
            <label class="admin-panel__title" for="description"><%= __("Group description") %></label>
            <div class="widget_narrow" >
                <textarea class="clr-textarea" id="description" name="description"><%= group.description %></textarea>
            </div>
        </div>

        <% if (users.length) { %>
            <label class="admin-panel__title" for="members"><%= __("Members") %></label>
            <% for (let user of users) { %>
                <% var userGroupsIds = [] %>
                <% if (user.groups && user.groups.length) { %>
                    <% userGroupsIds = user.groups.map((group) => {return group.id}) %>
                <% } %>
                <div class="clr-checkbox-inline">
                    <label for="checkbox-<%= user.id %>"><%= user.fullName %></label>
                    <% if (userGroupsIds.includes(group.id)) { %>
                        <input type="checkbox" id="checkbox-<%= user.id %>" name="checkbox-<%= user.id %>" checked>
                    <% } else { %>
                        <input type="checkbox" id="checkbox-<%= user.id %>" name="checkbox-<%= user.id %>">
                    <% } %>
                </div>
            <% } %>
        <% } %>

        СДЕЛАТЬ ПРОВЕРКУ НА CHECKED
        <% if (Object.keys(groupedTokens).length) { %>
            <% for (let [department, tokens] of Object.entries(groupedTokens)) { %>
                <h2><%= department %></h2>
                <div class="clr-row">
                    <div class="clr-col-sm-12 clr-col-md-6">
                        <div class="admin-panel__widget">
                            <% for (let token of tokens) { %>
                                <div class="clr-checkbox-inline">
                                    <label for="checkbox-<%= token.id %>"><%= token.name %></label>
                                    <a href="..." role="tooltip" aria-haspopup="true" class="tooltip tooltip-right">
                                        <clr-icon shape="info-circle" size="24"></clr-icon>
                                        <span class="tooltip-content">SOMETHING<%= token.description %></span>
                                    </a>
                                    <input type="checkbox" id="checkbox-<%= token.id %>" name="checkbox-<%= token.id %>">
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            <% } %>
        <% } %>

        <div>
            <input class="clr-input" type="hidden" name="_csrf" value="<%= _csrf %>" />
        </div>

        <button raised="" class="btn-save" id="submit" onclick="submitForm()">
            <%= __("Save") %>
        </button>
    </div>
</form>

<script>
    function submitForm() {
        // check all fields
        $("#editGroupForm").submit();
    }
</script>
