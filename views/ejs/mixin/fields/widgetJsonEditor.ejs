<% var data = typeof value === 'object' ? JSON.stringify(value) : (value || '') %>
<textarea
    <%= field.config.required && 'required' %>
    <%= field.config.disabled && 'disabled'%>
    name="<%= key %>"
    id="form-<%= key %>" hidden><%- data %></textarea>

<script>

$('#form-<%= key %>').hide().after('<div id="form-<%= key %>-jsoneditor" style="width:100%; height:320px;"></div>');
jsonEditor['<%= key %>'] = new JSONEditor(
    $('#form-<%= key %>-jsoneditor')[0],
    <% if(field.config.options){ %>
        {...<%- JSON.stringify(field.config.options) %>,
            onValidationError: function(errors) {
                formState.hasError = Boolean(errors.length);
            }
        }
    <%}else{%>
        {modes: ['code', 'form', 'text', 'tree', 'view'], mode: "tree"}
    <% } %>
    ,<%- data %>
)
</script>