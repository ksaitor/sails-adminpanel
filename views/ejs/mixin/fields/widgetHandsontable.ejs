<textarea
        <%= field.config.required && 'required' %>
        <%= field.config.disabled && 'disabled'%>
        name="<%= key %>"
        id="form-<%= key %>">
    <%- JSON.stringify(value) %>
</textarea>
<div id="handsontable-<%= key %>"></div>

<% if (field.config.options.language) { %>
    <script src="/admin/assets/handsontable/dist/languages/<%= field.config.options.language %>.js"></script>
<% } %>

<script>

    let data<%=key%> =  JSON.parse(document.getElementById('form-<%= key %>').value);
    let container<%=key%> = document.getElementById('handsontable-<%= key %>');
    let options<%=key%> = <%- JSON.stringify(field.config.options) %>;
    let <%=key%> = new Handsontable(container<%=key%>, {
        data: data<%=key%>,
        ...options<%=key%>,
        afterChange: function (change, source) {
            if (source === 'loadData') {
                return; //don't save this change
            }

            let table = JSON.parse(document.getElementById('form-<%= key %>').value);
            if (!table) {
                table = Array(5).fill("").map(() => Array(5).fill(""))
            }

            table[change[0][0]][change[0][1]] = change[0][3];
            $('#form-<%= key %>').val(JSON.stringify(table));
        }
    });
</script>
