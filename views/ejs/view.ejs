<%- include("head") %>
<%- include("headContent") %>

<% var idField = adminpanel.configHelper.getIdentifierField(entity.config.model) %>
<% var data = record %>
<% var config = adminpanel.configHelper.getConfig() %>

<div class="horizontal layout">
    <div class="flex">
        <% var actionType = 'view' %>
       <%- include("mixin/globalActions", {actionType: actionType}) %>
    </div>
</div>
<div class="layout">

    <div class="horizontal end-justified layout">
        <a href="<%= entity.uri %>/">
            <button raised class="btn">
                <i class="las la-undo"></i>
                <%= __("Back to list") %>
            </button>
        </a>
        <!--  !TODO добавить экшен на view -->
        <% if (entity.config.edit && havePermission(`update-${entity.name}-model`, req.session.UserAP)) { %>
            <a href="<%= entity.uri %>/edit/<%= record[idField] %>">
                <button raised class="button-green">
                    <i class="las la-plus"></i>
                    <%= __("Edit record") %>
                </button>
            </a>
        <% } %>
        <% if (entity.config.remove && havePermission(`delete-${entity.name}-model`, req.session.UserAP)) { %>
            <a href="<%= entity.uri %>/remove/<%= record[idField] %>" onclick="return confirm('Are you sure ?');">
                <button raised class="button-red">
                    <i class="las la-trash"></i>
                    <%= __("Remove record") %>
                </button>
            </a>
        <% } %>
    </div>

    <div>

        <%# global variables %>
        <script>
            var jsonEditor = {};
            var aceCounter = 0;
            let editor = [];
            let textarea = [];
            var tables = {};
        </script>

        <% Object.keys(fields).forEach(function(key) { %>
            <% if ((!config.showORMtime) && (key === 'createdAt' || key === 'updatedAt')) return %>
            <% var field = fields[key] %>
            <% var value = adminpanel.viewHelper.getFieldValue(key, field, data) %>
            <div class="admin-panel__title">
                <%= __(field.config.title) %>
                <% if(fields[key].config.tooltip) { %>
                    <a href="javascript:void(0)" role="tooltip" aria-haspopup="true"
                       class="tooltip tooltip-md tooltip-top-right">
                        <i class="las la-info-circle"></i>
                        <span class="tooltip-content"><%= __(fields[key].config.tooltip) %></span>
                    </a>
                <% } %>
            </div>
            <% if (field.config.description) { %>
                <div class="admin-panel__description">
                    <%- __(field.config.description) %>
                </div>
            <% } %>
            <div class="admin-panel__widget disabled">
                <%- include("mixin/fieldWidget", {field: field, value: value, key: key}) %>
            </div>
        <% }) %>

    </div>
</div>

<%- include("footer") %>
