<%- include("head") %>
<%- include("headContent") %>
<div class="content__body">
    <div class="text-center">
        <p class="text-xl font-medium mb-3"><%= __("Run migrations") %>:</p>
        <button id="migrationsUpButton" class="btn btn-success btn-sm">
            <span><%= __("UP") %></span>
        </button>
        <button id="migrationsDownButton" class="btn btn-danger btn-sm" hidden>
            <span><%= __("DOWN") %></span>
        </button>
    </div>

    <table class="table mt-12" id="informationBlock">
        <thead>
        <tr>
            <th><%= __("Information block") %></th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>
<%- include("footer") %>

<script>
	$("#migrationsUpButton").on('click', function () {
		$.get(`<%- sails.config.adminpanel.routePrefix %>/processMigrations`, {
			action: "up"
		})
			.done(function (data) {
				$("#informationBlock").append(`<tr><td><p>Migrations 'up' method processed successfully</p></td></tr>`)
			})
			.fail(function (err) {
				console.error(err);
				$("#informationBlock").append(`<tr><td><p>Error trying to process migrations 'up' method: ${err.responseText}</p></td></tr>`)
			})
	})
	$("#migrationsDownButton").on('click', function () {
		$.get(`<%- sails.config.adminpanel.routePrefix %>/processMigrations`, {
			action: "down"
		})
			.done(function (data) {
				let status = data.success === true ? "success" : "failed"
				$("#informationBlock").append(`<tr><td><p>Migrations 'down' method processed successfully</p></td></tr>`)
			})
			.fail(function (err) {
				console.error(err);
				$("#informationBlock > tbody").append(`<tr><td><p>Error trying to process migrations 'down' method: ${err.responseText}</p></td></tr>`)
			})
	})
</script>
